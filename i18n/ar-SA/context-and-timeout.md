# السياق والمدة الزمنية

في جولانغ، نحن عادة نستخدم [السياق](https://golang.org/pkg/context/) لإجهاض المهام التي تعمل منذ وقت طويل. يستخدم Rod السياق للتعامل مع الإلغاء لعمليات حظر IO ، في معظم الأحيان يتم المهلة. وأنت بحاجة إلى إيلاء اهتمام خاص لهم.

إذا كنت غير مألوفة في السياق، يرجى قراءة [فهم السياق](understand-context.md) أولاً.

## إلغاء

على سبيل المثال، الكود أدناه ينشئ صفحة فارغة وينقلها إلى "github.com":

```go
page := rod.New().MustConnect().MustPage()
page.MustNavigate("http://github.com")
```

الآن، لنفترض أننا نريد إلغاء `MustNavigate` إذا استغرق أكثر من ثانية. في رود يمكننا أن نفعل شيئا كهذا:

```go
صفحة := rod.New().MustConnect().MustPage()

ctx، إلغاء := context.WithCancel(context.Background())
صفحة صفحة char@@0WithCancel := page.Context(ctx)

اذهب إلى وظيفة () {
    وقت. النوم (2 * time.Second)
    إلغاء()
}()

pageWithCancel.MustNavigate("http://github.com") // سيتم إلغاؤه بعد ثوانين
```

نحن نستخدم `الصفحة.السياق` لإنشاء نسخة ضحلة من صفحة ``. كلما نتصل بـ `إلغاء`، سيتم إلغاء العمليات التي تم تشغيلها بواسطة `الصفحة` ، يمكن أن تكون أي عملية، وليس فقط `MustNavigate`. لن يتأثر الأصل `صفحة` ، إذا استخدمناها للاتصال بالعمليات فلن يتم إلغاؤها.

هذا النمط ليس مميزًا لرود، يمكنك العثور على APIs مشابهة مثل [request.WithContext](https://golang.org/pkg/net/http/#Request.WithContext) في المكتبة العادية.

لأن `pageWithCancel` و `صفحة` مستقلة عن بعضها البعض، العمليات التي تشغلها `صفحة` لن تتأثر بالإلغائ:

```go
page.MustNavigate("http://github.com") // لن يتم إلغاؤها بعد ثواني
```

## مهلة

الرمز أعلاه هو مجرد طريقة لإنهاء عملية ما. وفي غولانغ، تكون المهلة عادة مجرد حالة خاصة من حالات الإلغاء. لأنه مفيد جداً، لقد أنشأنا مساعداً للقيام بنفس الشيء أعلاه، تسمى `مهلة`، لذا يمكن تقليل الكود أعلاه كما هو أدناه:

```go
الصفحة := rod.New().MustConnect().MustPage()
page.Timeout(2 * time.Second).MustNavigate("http://github.com")
```

`page.Timeout(2 * time.Second)` هو `الصفحة السابقة`. ليس فقط `الصفحة`و `المتصفح` و `العنصر` لديه أيضا نفس المساعدين.

## كشف المهلة

كيف أعرف ما إذا كانت العملية قد انتهت أم لا؟ في غولانغ، تكون المهلة عادة نوعا من الأخطاء. إنها ليست مميزة لرود بالنسبة للتعليمات البرمجية أعلاه يمكننا القيام بذلك للكشف عن المهلة:

```go
الصفحة := rod.New().MustConnect().MustPage()

err := rod.Try(func() {
    page.Timeout(2 * time.Second).MustNavigate("http://github.com")
})
إذا كانت الأخطاء. (خطأ، سياق. eadlineExceeded) {
    // كود خطأ مهلة
} أخرى إذا كان خطأ! لا شيء
    // رمز لأنواع الأخطاء الأخرى
}
```

هنا نستخدم `rod.حاول` لإغلاق الدالة التي قد ترمي خطأ في المهلة.

سوف نتحدث أكثر عن الخطأ في التعامل مع [خطأ في التعامل مع](error-handling.md).
